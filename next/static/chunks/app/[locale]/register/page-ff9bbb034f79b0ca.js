(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8011],{668:(e,t,r)=>{"use strict";r.d(t,{A:()=>d,AuthProvider:()=>c});var o=r(5155),a=r(2115),i=r(5695),s=r(6720),n=r(5203);let l=(0,a.createContext)(void 0),c=e=>{let{children:t}=e,[c,d]=(0,a.useState)(!1),[u,m]=(0,a.useState)(null),g=(0,i.useRouter)(),p=(0,i.usePathname)().split("/")[1]||"en";(0,a.useEffect)(()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("userId"),o=localStorage.getItem("tokenTimestamp");e&&t&&o&&(Date.now()-parseInt(o,10)>864e5?h():(d(!0),m(t),Promise.resolve().then(r.bind(r,5203)).then(e=>{let{useCartStore:r}=e;r.getState().syncWithBackend(t,p)}).catch(e=>{console.error("Error syncing cart on initial load:",e)})))},[p]);let f=async(e,t)=>{localStorage.setItem("token",e),localStorage.setItem("userId",t),localStorage.setItem("tokenTimestamp",Date.now().toString()),d(!0),m(t);try{await Promise.resolve().then(r.bind(r,5203)).then(e=>{let{useCartStore:r}=e;return r.getState().syncWithBackend(t,p)})}catch(e){console.error("Error syncing cart after login:",e)}},h=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("No token found in localStorage for logout.");await (0,s.PZ)(e),console.log("Logout successful")}catch(e){console.error("Logout failed:",e)}localStorage.removeItem("token"),localStorage.removeItem("userId"),localStorage.removeItem("tokenTimestamp"),d(!1),m(null),n.useCartStore.getState().logout(),g.push("/".concat(p,"/login"))};return(0,o.jsx)(l.Provider,{value:{isAuthenticated:c,userId:u,login:f,logout:h},children:t})},d=()=>{let e=(0,a.useContext)(l);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},2385:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>p});var o=r(5155),a=r(2115),i=r(7652),s=r(5695),n=r(6874),l=r.n(n),c=r(8868);r(133);var d=r(9365),u=r.n(d),m=r(668),g=r(6720);function p(){let e=(0,i.c3)("signup"),t=(0,s.usePathname)(),r=(0,s.useRouter)(),n=(0,s.useSearchParams)(),{login:d,isAuthenticated:p}=(0,m.A)(),f=t.split("/")[1]||"ar",h=n.get("redirect")||"/",b=(0,a.useRef)(null),[y,x]=(0,a.useState)({firstName:"",lastName:"",email:"",password:"",confirmPassword:""}),[v,w]=(0,a.useState)(""),[_,N]=(0,a.useState)(!1);(0,a.useEffect)(()=>{p&&r.push("/".concat(f).concat(h))},[p,r,f,h]);let k=e=>{x({...y,[e.target.id]:e.target.value})},j=async t=>{if(t.preventDefault(),w(""),N(!0),y.password!==y.confirmPassword){w(e("passwordMismatch")),N(!1);return}try{let t=b.current?(0,c.l)("+".concat(b.current)):null;if(!t||!t.isValid()){console.log("Invalid phone number:",b.current),w(e("invalidPhone")),N(!1);return}let o="+".concat(t.countryCallingCode).concat(t.nationalNumber),a={first_name:y.firstName,last_name:y.lastName,email:y.email,password:y.password,phone_number:o,language:f,ip_country_id:"12"};console.log("Data to send:",a);let i=await (0,g.kz)(a);console.log("Response:",i);let{token:s,user:n}=i;if(!s||!(null==n?void 0:n.id))throw Error(e("signupFailed"));await d(s,n.id),r.push("/".concat(f).concat(h))}catch(r){console.error("Registration error:",r);let t=r instanceof Error?r:Error(e("signupFailed"));w(t.message.includes("Network Error")?e("corsError"):t.message||e("signupFailed"))}finally{N(!1)}};return(0,o.jsx)("main",{className:"flex-grow mx-auto px-4 py-10 flex justify-center max-w-7xl mb-40",children:(0,o.jsxs)("div",{className:"w-full max-w-md rounded-3xl border-2 border-[#94f198] p-8 shadow-lg relative overflow-hidden",children:[(0,o.jsx)("div",{className:"absolute inset-0 bg-[var(--primary-bg)] backdrop-blur-md z-0"}),(0,o.jsxs)("div",{className:"relative z-10 mx-auto mb-4",children:[(0,o.jsx)("h1",{className:"text-2xl font-bold text-center mb-1 text-[var(--text-primary)]",children:e("title")}),(0,o.jsx)("div",{className:"w-24 h-1 bg-[#94f198] mx-auto mb-4"}),(0,o.jsx)("p",{className:"text-center text-gray-600 mb-8",children:e("welcome")}),v&&(0,o.jsx)("p",{className:"text-red-500 text-center mb-4",children:v}),(0,o.jsxs)("form",{onSubmit:j,className:"space-y-4",children:[(0,o.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"firstName",className:"block text-gray-700 mb-2",children:e("firstName")}),(0,o.jsx)("input",{type:"text",id:"firstName",placeholder:e("firstName"),value:y.firstName,onChange:k,className:"w-full px-4 py-3 rounded-md bg-gradient-to-tl from-[#c1ebc3] to-[#94f198] border-none focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#94f198]",required:!0,autoComplete:"given-name"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"lastName",className:"block text-gray-700 mb-2",children:e("lastName")}),(0,o.jsx)("input",{type:"text",id:"lastName",placeholder:e("lastName"),value:y.lastName,onChange:k,className:"w-full px-4 py-3 rounded-md bg-gradient-to-tl from-[#c1ebc3] to-[#94f198] border-none focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#94f198]",required:!0,autoComplete:"family-name"})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"email",className:"block text-gray-700 mb-2",children:e("email")}),(0,o.jsx)("input",{type:"email",id:"email",placeholder:e("email"),value:y.email,onChange:k,className:"w-full px-4 py-3 rounded-md bg-gradient-to-tl from-[#c1ebc3] to-[#94f198] border-none focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#94f198]",required:!0,autoComplete:"email"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"phone",className:"block text-gray-700 mb-2",children:e("phone")}),(0,o.jsx)("div",{dir:"ltr",className:"relative",children:(0,o.jsx)(u(),{country:"jo",value:b.current||"",containerClass:"w-full",onChange:e=>{b.current=e,console.log("Phone input:",e)},inputProps:{id:"phone",required:!0,className:"w-full pl-16 py-3 rounded-md bg-gradient-to-tl from-[#c1ebc3] to-[#94f198] border-none focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#94f198]"},buttonStyle:{border:"none",backgroundColor:"transparent",padding:"8px",cursor:"pointer",left:"0",top:"0",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},dropdownStyle:{zIndex:1e3,top:"100%",left:"0"}})})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"password",className:"block text-gray-700 mb-2",children:e("password")}),(0,o.jsx)("input",{type:"password",id:"password",placeholder:e("password"),value:y.password,onChange:k,className:"w-full px-4 py-3 rounded-md bg-gradient-to-tl from-[#c1ebc3] to-[#94f198] border-none focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#94f198]",required:!0,autoComplete:"new-password"})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"confirmPassword",className:"block text-gray-700 mb-2",children:e("confirmPassword")}),(0,o.jsx)("input",{type:"password",id:"confirmPassword",placeholder:e("confirmPassword"),value:y.confirmPassword,onChange:k,className:"w-full px-4 py-3 rounded-md bg-gradient-to-tl from-[#c1ebc3] to-[#94f198] border-none focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[#94f198]",required:!0,autoComplete:"new-password"})]}),(0,o.jsx)("button",{type:"submit",disabled:_,className:"w-full bg-[#94f198] hover:bg-[#7ad97e] text-black py-3 rounded-md font-medium uppercase transition-colors disabled:bg-gray-400",children:_?e("loading"):e("signup")}),(0,o.jsx)("div",{className:"text-center mt-6",children:(0,o.jsxs)("p",{className:"text-gray-600",children:[e("haveAccount")," ",(0,o.jsx)(l(),{href:h?"/".concat(f,"/login?redirect=").concat(encodeURIComponent(h)):"/".concat(f,"/login"),className:"font-bold text-[var(--text-primary)] hover:text-[var(--text-hover)]",children:e("login")})," ",e("loginLinkText")]})})]})]})]})})}},3290:(e,t,r)=>{Promise.resolve().then(r.bind(r,2385))},5203:(e,t,r)=>{"use strict";r.r(t),r.d(t,{useCartStore:()=>n});var o=r(5453),a=r(6786),i=r(6720);let s=e=>e instanceof Error?e.message.includes("customer_id")||e.message.includes("The selected")?"Invalid user ID. Please log in again or contact support.":e.message.includes("POST method is not supported")?"Cart sync failed due to server configuration. Please try again later.":e.message||"Operation failed. Please try again.":"Operation failed.",n=(0,o.v)()((0,a.eh)((0,a.Zr)((e,t)=>({items:[],isLoading:!1,error:null,addItem:async(r,o,a)=>{e({isLoading:!0,error:null});let n=t().items;try{let s=n.find(e=>e.product_id===r.product_id),l=s?s.quantity+1:1,c={...r,id:(null==s?void 0:s.id)||Date.now(),customer_id:o||"guest",quantity:l};s?e({items:n.map(e=>e.product_id===r.product_id?c:e)}):e({items:[...n,c]}),o&&(await (0,i.V2)({customer_id:o,product_id:r.product_id,quantity:l},a),await t().syncWithBackend(o,a))}catch(t){console.error("Error adding item to cart:",t),e({items:n,error:s(t)})}finally{e({isLoading:!1})}},removeItem:async(r,o,a)=>{e({isLoading:!0,error:null});let n=t().items;try{let s=n.find(e=>e.product_id===r);if(!s)return;e({items:n.filter(e=>e.product_id!==r)}),o&&(await (0,i.V2)({customer_id:o,product_id:s.product_id,quantity:0},a),await t().syncWithBackend(o,a))}catch(t){console.error("Error removing item from cart:",t),e({items:n,error:s(t)})}finally{e({isLoading:!1})}},updateQuantity:async(r,o,a,n)=>{e({isLoading:!0,error:null});let l=t().items;try{let s=l.find(e=>e.product_id===r);if(!s)return;o<=0?e({items:l.filter(e=>e.product_id!==r)}):e({items:l.map(e=>e.product_id===r?{...e,quantity:o}:e)}),a&&(await (0,i.V2)({customer_id:a,product_id:s.product_id,quantity:o},n),await t().syncWithBackend(a,n))}catch(t){console.error("Error updating cart item quantity:",t),e({items:l,error:s(t)})}finally{e({isLoading:!1})}},clearCart:async(r,o)=>{e({isLoading:!0,error:null});let a=t().items,n=localStorage.getItem("token");try{e({items:[]}),r&&await (0,i.sX)(r,o,n),await t().syncWithBackend(r,o)}catch(t){console.error("Error clearing cart:",t),e({items:a,error:s(t)})}finally{e({isLoading:!1})}},syncWithBackend:async(r,o)=>{if(!r){console.warn("No user authenticated or server-side, skipping cart sync");return}if(!localStorage.getItem("token")){console.warn("No token found, skipping cart sync");return}e({isLoading:!0,error:null});try{let a=(await (0,i.Fy)(r,o)).map(e=>({id:e.id,product_id:e.product_id,customer_id:e.customer_id,name_en:e.name_en,name_ar:e.name_ar,description_en:e.description_en,description_ar:e.description_ar,price:e.price,image:e.image,quantity:e.quantity})),s=t().items.filter(e=>"guest"===e.customer_id||e.customer_id===r),n=[];for(let e of a)n.push(e);for(let e of s)n.some(t=>t.product_id===e.product_id)||n.push({...e,customer_id:r});for(let t of(e({items:n,error:null}),n))await (0,i.V2)({customer_id:r,product_id:t.product_id,quantity:t.quantity},o)}catch(t){console.error("Error syncing with backend:",t),e({error:s(t)})}finally{e({isLoading:!1})}},logout:()=>{e({items:[],error:null}),console.log("Cart cleared on logout")},total:()=>t().items.reduce((e,t)=>e+(parseFloat(t.price)||0)*t.quantity,0),totalItems:()=>t().items.reduce((e,t)=>e+t.quantity,0)}),{name:"cart-storage",partialize:e=>({items:e.items})})));(async()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("userId");if(e&&t)try{let e=localStorage.getItem("locale")||"ar";await n.getState().syncWithBackend(t,e)}catch(e){console.error("Initial cart load error:",e)}})()}},e=>{var t=t=>e(e.s=t);e.O(0,[7540,7652,7244,129,4779,6720,8441,1684,7358],()=>t(3290)),_N_E=e.O()}]);