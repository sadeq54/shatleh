(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2256],{668:(e,r,t)=>{"use strict";t.d(r,{A:()=>d,AuthProvider:()=>c});var a=t(5155),s=t(2115),i=t(5695),l=t(6720),n=t(5203);let o=(0,s.createContext)(void 0),c=e=>{let{children:r}=e,[c,d]=(0,s.useState)(!1),[u,m]=(0,s.useState)(null),g=(0,i.useRouter)(),h=(0,i.usePathname)().split("/")[1]||"en";(0,s.useEffect)(()=>{let e=localStorage.getItem("token"),r=localStorage.getItem("userId"),a=localStorage.getItem("tokenTimestamp");e&&r&&a&&(Date.now()-parseInt(a,10)>864e5?p():(d(!0),m(r),Promise.resolve().then(t.bind(t,5203)).then(e=>{let{useCartStore:t}=e;t.getState().syncWithBackend(r,h)}).catch(e=>{console.error("Error syncing cart on initial load:",e)})))},[h]);let x=async(e,r)=>{localStorage.setItem("token",e),localStorage.setItem("userId",r),localStorage.setItem("tokenTimestamp",Date.now().toString()),d(!0),m(r);try{await Promise.resolve().then(t.bind(t,5203)).then(e=>{let{useCartStore:t}=e;return t.getState().syncWithBackend(r,h)})}catch(e){console.error("Error syncing cart after login:",e)}},p=async()=>{try{let e=localStorage.getItem("token");if(!e)throw Error("No token found in localStorage for logout.");await (0,l.PZ)(e),console.log("Logout successful")}catch(e){console.error("Logout failed:",e)}localStorage.removeItem("token"),localStorage.removeItem("userId"),localStorage.removeItem("tokenTimestamp"),d(!1),m(null),n.useCartStore.getState().logout(),g.push("/".concat(h,"/login"))};return(0,a.jsx)(o.Provider,{value:{isAuthenticated:c,userId:u,login:x,logout:p},children:r})},d=()=>{let e=(0,s.useContext)(o);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},2800:(e,r,t)=>{Promise.resolve().then(t.bind(t,8143))},5203:(e,r,t)=>{"use strict";t.r(r),t.d(r,{useCartStore:()=>n});var a=t(5453),s=t(6786),i=t(6720);let l=e=>e instanceof Error?e.message.includes("customer_id")||e.message.includes("The selected")?"Invalid user ID. Please log in again or contact support.":e.message.includes("POST method is not supported")?"Cart sync failed due to server configuration. Please try again later.":e.message||"Operation failed. Please try again.":"Operation failed.",n=(0,a.v)()((0,s.eh)((0,s.Zr)((e,r)=>({items:[],isLoading:!1,error:null,addItem:async(t,a,s)=>{e({isLoading:!0,error:null});let n=r().items;try{let l=n.find(e=>e.product_id===t.product_id),o=l?l.quantity+1:1,c={...t,id:(null==l?void 0:l.id)||Date.now(),customer_id:a||"guest",quantity:o};l?e({items:n.map(e=>e.product_id===t.product_id?c:e)}):e({items:[...n,c]}),a&&(await (0,i.V2)({customer_id:a,product_id:t.product_id,quantity:o},s),await r().syncWithBackend(a,s))}catch(r){console.error("Error adding item to cart:",r),e({items:n,error:l(r)})}finally{e({isLoading:!1})}},removeItem:async(t,a,s)=>{e({isLoading:!0,error:null});let n=r().items;try{let l=n.find(e=>e.product_id===t);if(!l)return;e({items:n.filter(e=>e.product_id!==t)}),a&&(await (0,i.V2)({customer_id:a,product_id:l.product_id,quantity:0},s),await r().syncWithBackend(a,s))}catch(r){console.error("Error removing item from cart:",r),e({items:n,error:l(r)})}finally{e({isLoading:!1})}},updateQuantity:async(t,a,s,n)=>{e({isLoading:!0,error:null});let o=r().items;try{let l=o.find(e=>e.product_id===t);if(!l)return;a<=0?e({items:o.filter(e=>e.product_id!==t)}):e({items:o.map(e=>e.product_id===t?{...e,quantity:a}:e)}),s&&(await (0,i.V2)({customer_id:s,product_id:l.product_id,quantity:a},n),await r().syncWithBackend(s,n))}catch(r){console.error("Error updating cart item quantity:",r),e({items:o,error:l(r)})}finally{e({isLoading:!1})}},clearCart:async(t,a)=>{e({isLoading:!0,error:null});let s=r().items,n=localStorage.getItem("token");try{e({items:[]}),t&&await (0,i.sX)(t,a,n),await r().syncWithBackend(t,a)}catch(r){console.error("Error clearing cart:",r),e({items:s,error:l(r)})}finally{e({isLoading:!1})}},syncWithBackend:async(t,a)=>{if(!t){console.warn("No user authenticated or server-side, skipping cart sync");return}if(!localStorage.getItem("token")){console.warn("No token found, skipping cart sync");return}e({isLoading:!0,error:null});try{let s=(await (0,i.Fy)(t,a)).map(e=>({id:e.id,product_id:e.product_id,customer_id:e.customer_id,name_en:e.name_en,name_ar:e.name_ar,description_en:e.description_en,description_ar:e.description_ar,price:e.price,image:e.image,quantity:e.quantity})),l=r().items.filter(e=>"guest"===e.customer_id||e.customer_id===t),n=[];for(let e of s)n.push(e);for(let e of l)n.some(r=>r.product_id===e.product_id)||n.push({...e,customer_id:t});for(let r of(e({items:n,error:null}),n))await (0,i.V2)({customer_id:t,product_id:r.product_id,quantity:r.quantity},a)}catch(r){console.error("Error syncing with backend:",r),e({error:l(r)})}finally{e({isLoading:!1})}},logout:()=>{e({items:[],error:null}),console.log("Cart cleared on logout")},total:()=>r().items.reduce((e,r)=>e+(parseFloat(r.price)||0)*r.quantity,0),totalItems:()=>r().items.reduce((e,r)=>e+r.quantity,0)}),{name:"cart-storage",partialize:e=>({items:e.items})})));(async()=>{let e=localStorage.getItem("token"),r=localStorage.getItem("userId");if(e&&r)try{let e=localStorage.getItem("locale")||"ar";await n.getState().syncWithBackend(r,e)}catch(e){console.error("Initial cart load error:",e)}})()},8143:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>f});var a=t(5155),s=t(2115),i=t(6766),l=t(7652),n=t(5695),o=t(4105),c=t(760),d=t(7863),u=t(6474),m=t(381),g=t(6874),h=t.n(g);function x(){return(0,a.jsx)("div",{className:"flex justify-center items-center min-h-screen bg-[var(--primary-bg)] px-4 sm:px-6 lg:px-8 py-16",children:(0,a.jsx)("div",{className:"bg-[var(--primary-bg)] rounded-3xl shadow-[var(--shadow-md)] p-8 w-full max-w-2xl animate-pulse",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"h-5 w-32 bg-gray-300 rounded mb-2"}),(0,a.jsx)("div",{className:"h-12 w-full bg-gray-300 rounded-lg"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"h-5 w-32 bg-gray-300 rounded mb-2"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"h-12 w-full bg-gray-300 rounded-lg"}),(0,a.jsx)("div",{className:"h-10 w-10 bg-gray-300 rounded"})]})]}),(0,a.jsx)("div",{className:"p-4 border border-[var(--secondary-bg)] rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-gray-300 rounded mr-4"}),(0,a.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,a.jsx)("div",{className:"h-4 w-48 bg-gray-300 rounded"}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"h-10 w-32 bg-gray-300 rounded-lg"}),(0,a.jsx)("div",{className:"h-4 w-48 bg-gray-300 rounded ml-4"})]})]})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"h-5 w-32 bg-gray-300 rounded mb-2"}),(0,a.jsx)("div",{className:"h-48 w-full bg-gray-300 rounded-lg"})]}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("div",{className:"h-12 w-48 bg-gray-300 rounded-full"})})]})})})}let p=e=>{let{onClose:r,currentLocale:t}=e,i=(0,l.c3)("serviceRequest"),n=(0,s.useRef)(null);return(0,s.useEffect)(()=>{let e=e=>{"Escape"===e.key&&r()},t=e=>{n.current&&!n.current.contains(e.target)&&r()};return document.addEventListener("keydown",e),document.addEventListener("mousedown",t),()=>{document.removeEventListener("keydown",e),document.removeEventListener("mousedown",t)}},[r]),(0,a.jsx)(c.N,{children:(0,a.jsx)("div",{className:"fixed inset-0 bg-opacity-50 flex items-center justify-center z-50",style:{backdropFilter:"blur(0.8px)"},children:(0,a.jsxs)(o.P.div,{ref:n,initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},transition:{duration:.3},className:"bg-[var(--primary-bg)] rounded-2xl p-8 max-w-md w-full mx-4 shadow-[var(--shadow-md)]",dir:"ar"===t?"rtl":"ltr",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-[var(--text-primary)] mb-4",children:i("successMessage")}),(0,a.jsx)("p",{className:"text-[var(--text-gray)] mb-6",children:"ar"===t?"تم إرسال طلب الخدمة بنجاح. يمكنك عرض تفاصيل الطلب في صفحة الطلبات.":"Your service request has been submitted successfully. You can view the request details in the orders page."}),(0,a.jsxs)("div",{className:"flex justify-between gap-4",children:[(0,a.jsx)(h(),{href:"/".concat(t,"/service-requests"),children:(0,a.jsx)(o.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"px-6 py-2 bg-[var(--accent-color)] text-[var(--text-white)] rounded-lg hover:bg-[var(--footer-accent)] transition-colors",children:"ar"===t?"عرض الطلبات":"View Orders"})}),(0,a.jsx)(h(),{href:"/".concat(t,"/"),children:(0,a.jsx)(o.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},className:"px-6 py-2 bg-[var(--accent-color)] text-[var(--text-white)] rounded-lg hover:bg-[var(--footer-accent)] transition-colors",children:"ar"===t?"الصفحة الرئيسية":"Home"})}),(0,a.jsx)(o.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:r,className:"px-6 py-2 border border-[var(--secondary-bg)] text-[var(--text-primary)] rounded-lg hover:bg-[var(--secondary-bg)] transition-colors",children:"ar"===t?"إلغاء":"Cancel"})]})]})})})};var v=t(6720),y=t(668);function f(){let e=(0,l.c3)("serviceRequest"),r=(0,n.usePathname)(),t=(0,n.useRouter)(),{id:g}=(0,n.useParams)(),{userId:f}=(0,y.A)(),b="en"===r.split("/")[1]?"en":"ar",[j,w]=(0,s.useState)(null),[N,_]=(0,s.useState)([]),[k,S]=(0,s.useState)(""),[I,P]=(0,s.useState)(!1),[q,E]=(0,s.useState)(null),[L,C]=(0,s.useState)(""),[R,A]=(0,s.useState)({}),[T,B]=(0,s.useState)(!0),[z,O]=(0,s.useState)(!1),W=[{id:1,name_en:"Tree and Plant Care",name_ar:"العناية بالأشجار والنباتات",description_en:"Full care services for trees and plants to help them grow healthy and beautiful.",description_ar:"خدمات متكاملة للعناية بالأشجار والنباتات لضمان نموها بشكل صحي وجميل.",image:"/agri services.jpg"},{id:2,name_en:"Agricultural Consultations",name_ar:"الاستشارات الزراعية",description_en:"Expert advice from agricultural engineers to improve plant care.",description_ar:"توجيهات ونصائح مهنية من مهندسين زراعيين مختصين لتحسين العناية بالنباتات.",image:"/educational content.webp"},{id:3,name_en:"Garden Landscaping",name_ar:"تنسيق الحدائق",description_en:"Designing and organizing small gardens with high quality to improve their look and use space wisely.",description_ar:"تصميم وتنظيم الحدائق الصغيرة بأعلى جودة لتحسين مظهرها واستخدام المساحات بشكل فعال.",image:"/best plants.jpg"}];(0,s.useEffect)(()=>{let r=localStorage.getItem("token"),a=localStorage.getItem("userId");if(!r||!a){t.push("/".concat(b,"/login?redirect=/service/").concat(g));return}(async()=>{try{B(!0);let[e,r]=await Promise.all([(0,v.jg)(),(0,v.ls)()]),a=parseInt(g),s=e.find(e=>e.id===a)||W.find(e=>e.id===a);if(!s){t.push("/".concat(b,"/services"));return}w(s),_(r);let i=r.find(e=>e.is_default);i&&S(i.id)}catch(s){console.error("Error fetching data:",s);let r=parseInt(g),a=W.find(e=>e.id===r);a?w(a):t.push("/".concat(b,"/services")),A(r=>({...r,submit:e("errors.fetchFailed")}))}finally{B(!1)}})()},[b,t,e,g]);let H=()=>{let r={};return k||(r.address=e("errors.addressRequired")),L.trim()||(r.details=e("errors.detailsRequired")),f||(r.customer_id=e("errors.customerRequired")),A(e=>({...e,...r})),0===Object.keys(r).length},F=async r=>{if(r.preventDefault(),A({}),H())try{var t;await (0,v.vh)({service_id:j.id,address_id:k,customer_id:f,details:L,image:q||void 0}),S((null===(t=N.find(e=>e.is_default))||void 0===t?void 0:t.id)||""),E(null),C(""),A({}),O(!0)}catch(r){if(r instanceof Error)try{let t=JSON.parse(r.message);if(t.errors&&t.errors.details){A(e=>({...e,details:t.errors.details[0]}));return}if(t.errors){let r=Object.keys(t.errors);if(r.includes("address_id")){A(r=>({...r,address:e("errors.addressRequired")}));return}if(r.includes("customer_id")){A(r=>({...r,customer_id:e("errors.customerRequired")}));return}if(r.includes("image")){A(r=>({...r,file:e("errors.fileSize")}));return}else{A(e=>({...e,submit:t.errors[r[0]][0]}));return}}if(t.message.includes("customer_id")){A(r=>({...r,customer_id:e("errors.customerRequired")}));return}A(e=>({...e,submit:t.message||r.message}))}catch(t){r.message.includes("details")?A(r=>({...r,details:e("errors.detailsRequired")})):r.message.includes("customer_id")?A(r=>({...r,customer_id:e("errors.customerRequired")})):A(t=>({...t,submit:r.message||e("errors.submitFailed")}))}else A(r=>({...r,submit:e("errors.submitFailed")}))}};return T?(0,a.jsx)(x,{}):j?(0,a.jsx)("div",{className:"min-h-screen bg-[var(--primary-bg)] px-4 sm:px-6 lg:px-8 py-12",dir:"ar"===b?"rtl":"ltr",children:(0,a.jsxs)(o.P.div,{className:"max-w-4xl mx-auto",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[(0,a.jsx)("div",{className:"bg-white rounded-2xl shadow-lg p-8 mb-8",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-6",children:[(0,a.jsx)(i.default,{src:j.image?"".concat("http://127.0.0.1:8000").concat(j.image):"/placeholder.svg",alt:"ar"===b?j.name_ar:j.name_en,width:400,height:300,className:"w-full md:w-1/2 h-64 object-cover rounded-lg"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-[var(--accent-color)] mb-4",children:"ar"===b?j.name_ar:j.name_en}),(0,a.jsx)("p",{className:"text-gray-600",children:"ar"===b?j.description_ar:j.description_en})]})]})}),(0,a.jsxs)(o.P.div,{className:"bg-white rounded-2xl shadow-lg p-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold text-[var(--accent-color)] mb-6",children:e("requestService")}),(0,a.jsxs)("form",{onSubmit:F,children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-[var(--text-primary)] mb-2",children:e("serviceName")}),(0,a.jsx)("div",{className:"w-full px-4 py-3 border border-[var(--secondary-bg)] rounded-lg text-[var(--text-primary)] bg-gray-100",children:"ar"===b?j.name_ar:j.name_en})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-[var(--text-primary)] mb-2",children:e("address")}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsxs)("button",{type:"button",className:"w-full px-4 py-3 border border-[var(--secondary-bg)] rounded-lg flex justify-between items-center text-[var(--text-primary)]",onClick:()=>P(!I),children:[(r=>{if(!r)return e("selectAddress");let t=N.find(e=>e.id===r);return t?"".concat(t.title," - ").concat(t.city,", ").concat(t.country_name||t.country_id):e("selectAddress")})(k),I?(0,a.jsx)(d.A,{className:"h-4 w-4 text-[var(--text-gray)]"}):(0,a.jsx)(u.A,{className:"h-4 w-4 text-[var(--text-gray)]"})]}),(0,a.jsx)(c.N,{children:I&&(0,a.jsx)(o.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"absolute z-10 w-full mt-1 border border-[var(--secondary-bg)] rounded-lg overflow-hidden bg-[var(--primary-bg)]",children:N.map((e,r)=>(0,a.jsxs)(o.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.05*r},className:"px-4 py-3 cursor-pointer hover:bg-[var(--secondary-bg)] hover:text-[var(--text-white)] ".concat(e.id===k?"bg-[var(--accent-color)] text-[var(--text-white)]":""),onClick:()=>{S(e.id),P(!1),A(e=>({...e,address:void 0}))},children:[e.title," - ",e.city,", ",e.country_name||e.country_id]},e.id))})})]}),(0,a.jsx)(h(),{href:"/".concat(b,"/address"),children:(0,a.jsx)(o.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"button",className:"p-2 text-[var(--text-gray)] hover:text-[var(--accent-color)]",title:e("manageAddresses"),children:(0,a.jsx)(m.A,{className:"w-5 h-5"})})})]}),R.address&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:R.address})]}),(0,a.jsx)(o.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},className:"mb-6 p-4 border border-[var(--secondary-bg)] rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-[var(--primary-bg)] flex items-center justify-center mr-4 rounded",children:(0,a.jsx)("svg",{className:"w-8 h-8 text-[var(--text-gray)]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm text-[var(--text-gray)] mb-2",children:e("imageInstructions")}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("label",{className:"inline-block",children:[(0,a.jsx)(o.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"button",className:"px-4 py-2 border border-[var(--accent-color)] text-[var(--accent-color)] rounded-lg hover:bg-[var(--focus-ring)] transition-colors",onClick:()=>{var e;return null===(e=document.getElementById("fileInput"))||void 0===e?void 0:e.click()},children:e("uploadImage")}),(0,a.jsx)("input",{id:"fileInput",type:"file",className:"hidden",accept:"image/*",onChange:r=>{if(r.target.files&&r.target.files[0]){let t=r.target.files[0];if(t.size>2097152){A(r=>({...r,file:e("errors.fileSize")}));return}E(t),A(e=>({...e,file:void 0}))}}})]}),(0,a.jsx)("span",{className:"mx-4 text-sm text-[var(--text-gray)]",children:q?q.name:"ar"===b?"لم يتم اختيار صورة":"No image selected"})]}),R.file&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:R.file})]})]})}),(0,a.jsxs)(o.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"mb-8",children:[(0,a.jsx)("label",{className:"block text-[var(--text-primary)] mb-2",children:e("tellUsMore")}),(0,a.jsx)(o.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},className:"w-full",children:(0,a.jsx)("textarea",{value:L,onChange:e=>{C(e.target.value),A(e=>({...e,details:void 0}))},placeholder:e("detailsPlaceholder"),className:"w-full min-h-[200px] resize-none border border-[var(--secondary-bg)] text-[var(--text-primary)] rounded-lg p-3 focus:ring-[var(--focus-ring)] focus:ring-2 outline-none",required:!0})}),R.details&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:R.details})]}),R.submit&&(0,a.jsx)("p",{className:"text-red-500 text-sm mb-4 text-center",children:R.submit}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(o.P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},type:"submit",className:"px-8 py-3 bg-[var(--accent-color)] text-[var(--text-white)] rounded-full hover:bg-[var(--footer-accent)] transition-colors w-full max-w-xs",children:"ar"===b?"إرسال الطلب":"Submit Request"})})]})]}),(0,a.jsx)(c.N,{children:z&&(0,a.jsx)(p,{onClose:()=>O(!1),currentLocale:b})})]})}):null}}},e=>{var r=r=>e(e.s=r);e.O(0,[7652,7244,4105,6766,6804,6720,8441,1684,7358],()=>r(2800)),_N_E=e.O()}]);