(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8157],{1004:(e,r,a)=>{"use strict";a.d(r,{A:()=>m});var t=a(5155),s=a(6874),l=a.n(s),o=a(2355),i=a(3052),n=a(7652),c=a(5695),d=a(2115);let m=(0,d.memo)(function(e){let{pageName:r,product:a}=e,s=(0,n.c3)(""),m=(0,c.usePathname)(),u=m.split("/")[1]||"ar",x=s("pages.".concat(r.toLocaleLowerCase()));return"ar"===u?(0,t.jsxs)("div",{className:"flex items-center text-sm mb-2",children:[(0,t.jsx)(l(),{href:"/",className:"text-[#025162]",children:s("home.title")}),(0,t.jsx)(o.A,{className:"h-4 w-4 mx-1 text-[#80ce97]"}),(0,t.jsx)(l(),{href:"/".concat(u,"/").concat(r),className:"text-[#025162]",children:(0,t.jsx)("span",{className:"text-[#025162]",children:x})}),a&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(o.A,{className:"h-4 w-4 mx-1 text-[#80ce97]"}),(0,t.jsx)("span",{className:"text-[#025162]",children:a})]})]}):(0,t.jsxs)("div",{className:"flex items-center text-sm mb-2",children:[(0,t.jsx)(l(),{href:"/",className:"text-[#025162]",children:s("home.title")}),m.split("/").map((e,r)=>1!==r&&0!==r&&isNaN(parseInt(e))?(0,t.jsxs)(d.Fragment,{children:[(0,t.jsx)(i.A,{className:"h-4 w-4 mx-1 text-[#80ce97]"}),(0,t.jsx)(l(),{href:"/".concat(e),className:"text-[#025162]",children:(0,t.jsx)("span",{className:"text-[#025162]",children:e})})]},e):null),a&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.A,{className:"h-4 w-4 mx-1 text-[#80ce97]"}),(0,t.jsx)("span",{className:"text-[#025162]",children:a})]})]})})},2e3:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>f});var t=a(5155),s=a(2115),l=a(7652),o=a(5695),i=a(6874),n=a.n(i),c=a(6766),d=a(1004);function m(e){let{currentLocale:r}=e,a=(0,l.c3)("");return(0,t.jsx)("div",{className:"min-h-screen flex flex-col",style:{backgroundColor:"var(--primary-bg)"},dir:"ar"===r?"rtl":"ltr",role:"status","aria-live":"polite","aria-label":a("Cart.loading"),children:(0,t.jsxs)("main",{className:"container mx-auto max-w-full sm:max-w-7xl px-4 sm:px-6 lg:px-8 py-12 flex-grow",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"h-4 w-16 bg-gray-200 rounded animate-pulse"}),(0,t.jsx)("div",{className:"h-4 w-4 bg-gray-200 rounded-full animate-pulse"}),(0,t.jsx)("div",{className:"h-4 w-24 bg-gray-200 rounded animate-pulse"})]}),(0,t.jsx)("div",{className:"mt-4 h-8 w-48 bg-gray-200 rounded animate-pulse mx-auto"})]}),(0,t.jsxs)("div",{className:"max-w-2xl mx-auto rounded-lg shadow-md p-8",style:{backgroundColor:"var(--primary-bg)",borderColor:"var(--secondary-bg)"},children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("div",{className:"h-5 w-32 bg-gray-200 rounded animate-pulse"}),(0,t.jsx)("div",{className:"h-4 w-24 bg-gray-200 rounded animate-pulse mt-2"})]}),(0,t.jsxs)("div",{className:"text-center mb-6",children:[(0,t.jsx)("div",{className:"h-6 w-40 bg-gray-200 rounded animate-pulse mx-auto mb-4"}),(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)("div",{className:"h-32 w-32 bg-gray-200 rounded animate-pulse"})})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("div",{className:"h-5 w-32 bg-gray-200 rounded animate-pulse mb-4"}),(0,t.jsxs)("div",{className:"space-y-3",children:[[void 0,void 0].map((e,r)=>(0,t.jsxs)("div",{className:"flex items-center justify-between border-b border-dashed pb-2",style:{borderColor:"var(--secondary-bg)"},children:[(0,t.jsx)("div",{className:"h-4 w-1/3 bg-gray-200 rounded animate-pulse"}),(0,t.jsx)("div",{className:"h-4 w-16 bg-gray-200 rounded animate-pulse"}),(0,t.jsx)("div",{className:"h-4 w-20 bg-gray-200 rounded animate-pulse"})]},r)),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-2",children:[(0,t.jsx)("div",{className:"h-4 w-24 bg-gray-200 rounded animate-pulse"}),(0,t.jsx)("div",{className:"h-4 w-20 bg-gray-200 rounded animate-pulse"})]})]})]}),(0,t.jsxs)("div",{className:"text-center mb-6 flex flex-col sm:flex-row justify-center gap-4",children:[(0,t.jsx)("div",{className:"h-10 w-40 bg-gray-200 rounded animate-pulse"}),(0,t.jsx)("div",{className:"h-10 w-40 bg-gray-200 rounded animate-pulse"})]}),(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("div",{className:"h-4 w-48 bg-gray-200 rounded animate-pulse mx-auto"})})]})]})})}var u=a(3999),x=a(2699),p=a.n(x),g=a(4477);let h=(0,g.createServerReference)("78474ca4f553321c9defe4c7a41a076bdcb33d47b4",g.callServer,void 0,g.findSourceMapURL,"processOrder");var y=a(5203);function f(){let e=(0,l.c3)("checkout"),r=(0,o.useSearchParams)(),a="en"===(0,o.usePathname)().split("/")[1]?"en":"ar",i=r.get("session_id"),[x,g]=(0,s.useState)(null),[f,v]=(0,s.useState)(!0),[b,j]=(0,s.useState)(null),N=(0,y.useCartStore)(e=>e.clearCart);(0,s.useEffect)(()=>{(async()=>{console.log("Loading order data");let r=localStorage.getItem("lastOrder"),t=localStorage.getItem("userId"),s=localStorage.getItem("token");if(!t){console.error("User ID not found in localStorage"),j(e("errors.userIdNotFound")),v(!1);return}if(!s){console.error("Authentication token not found in localStorage"),j(e("errors.noToken")),v(!1);return}if(r)try{let e=JSON.parse(r);g(e),v(!1),localStorage.removeItem("lastOrder"),N(t,a);return}catch(r){console.error("Error parsing lastOrder:",r),j(e("errors.invalidOrderData")),v(!1);return}if(i)try{let r=await h(i,t,a,s);if(r.success&&r.lastOrder){var l;let e={...r.lastOrder,couponApplied:null!==(l=r.lastOrder.couponApplied)&&void 0!==l&&l};g(e),localStorage.setItem("lastOrder",JSON.stringify(e)),r.lastOrder.couponApplied&&localStorage.removeItem("appliedCoupon"),N(t,a)}else console.error("processOrder failed:",r.error),j(e("errors.orderProcessingFailed"))}catch(r){console.error("Error processing Stripe order:",r),j(e("errors.orderProcessingFailed"))}v(!1)})()},[i,a,e]);let w=x?new Date(x.orderDate).toLocaleDateString("ar"===a?"ar-JO":"en-US",{year:"numeric",month:"long",day:"numeric"}):new Date().toLocaleDateString("ar"===a?"ar-JO":"en-US",{year:"numeric",month:"long",day:"numeric"}),_=async()=>{let r=document.getElementById("capture-section");if(r)try{let e=r.style.padding,a=r.style.backgroundColor;r.style.padding="20px",r.style.backgroundColor="#e8f5e9";let t=await p()(r,{scale:2,useCORS:!0,backgroundColor:"#e8f5e9",height:r.scrollHeight+40,width:r.scrollWidth+40});r.style.padding=e,r.style.backgroundColor=a;let s=t.toDataURL("image/png"),l=document.createElement("a");l.href=s,l.download="order_".concat(null==x?void 0:x.orderId,".png"),l.click()}catch(r){console.error("Error generating image:",r),alert(e("errors.checkoutFailed"))}};return f?(0,t.jsx)(m,{currentLocale:a}):b?(0,t.jsx)("div",{className:"min-h-screen",style:{backgroundColor:"var(--primary-bg)"},dir:"ar"===a?"rtl":"ltr",children:(0,t.jsxs)("main",{className:"container mx-auto max-w-full sm:max-w-7xl px-4 sm:px-6 lg:px-8 py-12",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)(d.A,{pageName:"success"}),(0,t.jsx)("h1",{className:"text-4xl font-bold text-center mt-4",style:{color:"var(--text-primary)",fontSize:"36px"},children:e("error")})]}),(0,t.jsxs)("div",{className:"max-w-2xl mx-auto rounded-lg shadow-md p-8 text-center",style:{backgroundColor:"var(--primary-bg)",borderColor:"var(--secondary-bg)"},children:[(0,t.jsx)("p",{style:{color:"var(--text-primary)"},children:b}),(0,t.jsx)(n(),{href:"/".concat(a,"/products"),className:"inline-block font-medium py-3 px-6 rounded-md mt-4",style:{backgroundColor:"var(--secondary-bg)",color:"var(--text-white)"},children:e("continueShopping")})]})]})}):x?(0,t.jsx)("div",{className:"min-h-screen",style:{backgroundColor:"var(--primary-bg)"},children:(0,t.jsxs)("main",{className:"container mx-auto max-w-full sm:max-w-7xl px-4 sm:px-6 lg:px-8 py-12",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)(d.A,{pageName:"success"}),(0,t.jsx)("h1",{className:"text-4xl font-bold text-center mt-4",style:{color:"var(--text-primary)",fontSize:"36px"},children:e("success")})]}),(0,t.jsxs)("div",{id:"order-summary",className:"max-w-2xl mx-auto rounded-lg shadow-md p-8",style:{backgroundColor:"var(--primary-bg)",borderColor:"var(--secondary-bg)"},children:[(0,t.jsxs)("div",{id:"capture-section",children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("h2",{className:"font-medium",style:{color:"var(--accent-color)"},children:e("orderId",{id:x.orderId})}),(0,t.jsx)("p",{className:"text-sm",style:{color:"var(--text-gray)"},children:w})]}),(0,t.jsxs)("div",{className:"text-center mb-6",children:[(0,t.jsx)("h3",{className:"text-xl font-medium mb-4",style:{color:"var(--accent-color)"},children:e("thankYou")}),(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)(c.default,{src:"/success.svg",alt:e("illustrationAlt"),width:180,height:180,className:"mb-4"})})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("h3",{className:"font-medium mb-4",style:{color:"var(--accent-color)"},children:e("orderSummary")}),(0,t.jsxs)("div",{className:"space-y-3",children:[x.items.map(r=>(0,t.jsxs)("div",{className:"flex items-center justify-between border-b border-dashed pb-2",style:{borderColor:"var(--secondary-bg)"},children:[(0,t.jsx)("span",{style:{color:"var(--text-primary)"},children:"ar"===a?r.name_ar:r.name_en}),(0,t.jsxs)("span",{style:{color:"var(--text-gray)"},children:[e("quantity")+" : ",r.quantity]}),(0,t.jsx)("span",{className:"font-medium",style:{color:"var(--text-primary)"},children:(0,u.$)(Number.parseFloat(r.price.replace(/[^\d.]/g,"")).toFixed(2),a)})]},r.id)),(0,t.jsxs)("div",{className:"flex items-center justify-between pt-2",children:[(0,t.jsx)("span",{className:"font-medium",style:{color:"var(--text-primary)"},children:e("total")}),(0,t.jsx)("span",{}),(0,t.jsx)("span",{className:"font-medium",style:{color:"var(--text-primary)"},children:(0,u.$)(x.total,a)})]})]})]})]}),(0,t.jsxs)("div",{className:"text-center mb-6 flex flex-col sm:flex-row justify-center gap-4",children:[(0,t.jsx)(n(),{href:"/".concat(a,"/products"),onClick:()=>{localStorage.removeItem("lastOrder")},className:"inline-block font-medium py-3 px-6 rounded-md",style:{backgroundColor:"var(--secondary-bg)",color:"var(--text-white)"},children:e("continueShopping")}),(0,t.jsx)("button",{onClick:_,className:"inline-block font-medium py-3 px-6 rounded-md hover:cursor-pointer",style:{backgroundColor:"var(--accent-color)",color:"var(--text-white)"},children:e("exportPDF")})]}),(0,t.jsxs)("div",{className:"text-center text-sm",style:{color:"var(--text-gray)"},children:[e("support")," ",(0,t.jsx)(n(),{href:"/".concat(a,"/contact"),className:"underline",style:{color:"var(--accent-color)"},children:e("contactSupport")})]})]})]})}):(0,t.jsx)(m,{currentLocale:a})}},3796:(e,r,a)=>{Promise.resolve().then(a.bind(a,2e3))},3999:(e,r,a)=>{"use strict";function t(e,r){let a="string"==typeof e?parseFloat(e):e;if(isNaN(a))return"ar"===r?"غير متوفر":"Not available";let t=new Intl.NumberFormat("ar"===r?"ar-JO":"en-US",{minimumFractionDigits:2,maximumFractionDigits:2});return"".concat(t.format(a)," ").concat("ar"===r?"د.أ":"JD")}function s(e,r,a){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;if(!e||!e.categories||0===e.categories.length)return r.filter(r=>r.id!==(null==e?void 0:e.id)).sort(()=>Math.random()-.5).slice(0,t);let s=e.categories.filter(e=>null===e.parent_id).map(e=>e.id),l=e.categories.filter(e=>null!==e.parent_id).map(e=>e.id),o=new Set;for(let e of l)for(let r of a)r.subcategories.some(r=>r.id===e)&&o.add(r.id);let i=[...r.filter(r=>{if(r.id===e.id)return!1;let t=r.categories.map(e=>e.id);if(t.some(e=>t.includes(e))||t.some(e=>o.has(e)))return!0;for(let e of s)for(let r of a)if(r.id===e&&t.some(e=>r.subcategories.some(r=>r.id===e)))return!0;return!1})];if(i.length<t){let a=new Set(i.map(e=>e.id).concat(e.id)),s=r.filter(e=>!a.has(e.id)).sort(()=>Math.random()-.5);i.push(...s.slice(0,t-i.length))}return i.sort(()=>Math.random()-.5).slice(0,t)}a.d(r,{$:()=>t,S:()=>s})},5203:(e,r,a)=>{"use strict";a.r(r),a.d(r,{useCartStore:()=>i});var t=a(5453),s=a(6786),l=a(6720);let o=e=>e instanceof Error?e.message.includes("customer_id")||e.message.includes("The selected")?"Invalid user ID. Please log in again or contact support.":e.message.includes("POST method is not supported")?"Cart sync failed due to server configuration. Please try again later.":e.message||"Operation failed. Please try again.":"Operation failed.",i=(0,t.v)()((0,s.eh)((0,s.Zr)((e,r)=>({items:[],isLoading:!1,error:null,addItem:async(a,t,s)=>{e({isLoading:!0,error:null});let i=r().items;try{let o=i.find(e=>e.product_id===a.product_id),n=o?o.quantity+1:1,c={...a,id:(null==o?void 0:o.id)||Date.now(),customer_id:t||"guest",quantity:n};o?e({items:i.map(e=>e.product_id===a.product_id?c:e)}):e({items:[...i,c]}),t&&(await (0,l.V2)({customer_id:t,product_id:a.product_id,quantity:n},s),await r().syncWithBackend(t,s))}catch(r){console.error("Error adding item to cart:",r),e({items:i,error:o(r)})}finally{e({isLoading:!1})}},removeItem:async(a,t,s)=>{e({isLoading:!0,error:null});let i=r().items;try{let o=i.find(e=>e.product_id===a);if(!o)return;e({items:i.filter(e=>e.product_id!==a)}),t&&(await (0,l.V2)({customer_id:t,product_id:o.product_id,quantity:0},s),await r().syncWithBackend(t,s))}catch(r){console.error("Error removing item from cart:",r),e({items:i,error:o(r)})}finally{e({isLoading:!1})}},updateQuantity:async(a,t,s,i)=>{e({isLoading:!0,error:null});let n=r().items;try{let o=n.find(e=>e.product_id===a);if(!o)return;t<=0?e({items:n.filter(e=>e.product_id!==a)}):e({items:n.map(e=>e.product_id===a?{...e,quantity:t}:e)}),s&&(await (0,l.V2)({customer_id:s,product_id:o.product_id,quantity:t},i),await r().syncWithBackend(s,i))}catch(r){console.error("Error updating cart item quantity:",r),e({items:n,error:o(r)})}finally{e({isLoading:!1})}},clearCart:async(a,t)=>{e({isLoading:!0,error:null});let s=r().items,i=localStorage.getItem("token");try{e({items:[]}),a&&await (0,l.sX)(a,t,i),await r().syncWithBackend(a,t)}catch(r){console.error("Error clearing cart:",r),e({items:s,error:o(r)})}finally{e({isLoading:!1})}},syncWithBackend:async(a,t)=>{if(!a){console.warn("No user authenticated or server-side, skipping cart sync");return}if(!localStorage.getItem("token")){console.warn("No token found, skipping cart sync");return}e({isLoading:!0,error:null});try{let s=(await (0,l.Fy)(a,t)).map(e=>({id:e.id,product_id:e.product_id,customer_id:e.customer_id,name_en:e.name_en,name_ar:e.name_ar,description_en:e.description_en,description_ar:e.description_ar,price:e.price,image:e.image,quantity:e.quantity})),o=r().items.filter(e=>"guest"===e.customer_id||e.customer_id===a),i=[];for(let e of s)i.push(e);for(let e of o)i.some(r=>r.product_id===e.product_id)||i.push({...e,customer_id:a});for(let r of(e({items:i,error:null}),i))await (0,l.V2)({customer_id:a,product_id:r.product_id,quantity:r.quantity},t)}catch(r){console.error("Error syncing with backend:",r),e({error:o(r)})}finally{e({isLoading:!1})}},logout:()=>{e({items:[],error:null}),console.log("Cart cleared on logout")},total:()=>r().items.reduce((e,r)=>e+(parseFloat(r.price)||0)*r.quantity,0),totalItems:()=>r().items.reduce((e,r)=>e+r.quantity,0)}),{name:"cart-storage",partialize:e=>({items:e.items})})));(async()=>{let e=localStorage.getItem("token"),r=localStorage.getItem("userId");if(e&&r)try{let e=localStorage.getItem("locale")||"ar";await i.getState().syncWithBackend(r,e)}catch(e){console.error("Initial cart load error:",e)}})()}},e=>{var r=r=>e(e.s=r);e.O(0,[4316,7652,7244,6766,9597,6720,8441,1684,7358],()=>r(3796)),_N_E=e.O()}]);